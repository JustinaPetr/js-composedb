"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[9816],{4852:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>g});var r=t(9231);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=r.createContext({}),c=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=c(e.components);return r.createElement(l.Provider,{value:n},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=c(t),m=o,g=p["".concat(l,".").concat(m)]||p[m]||d[m]||a;return t?r.createElement(g,i(i({ref:n},u),{},{components:t})):r.createElement(g,i({ref:n},u))}));function g(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,i=new Array(a);i[0]=m;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[p]="string"==typeof e?e:o,i[1]=s;for(var c=2;c<a;c++)i[c]=t[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},1883:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>c});var r=t(5675),o=(t(9231),t(4852));const a={},i="Running in the Cloud",s={unversionedId:"guides/composedb-server/running-in-the-cloud",id:"version-0.4.x/guides/composedb-server/running-in-the-cloud",title:"Running in the Cloud",description:"Run a ComposeDB server in the cloud",source:"@site/versioned_docs/version-0.4.x/guides/composedb-server/running-in-the-cloud.mdx",sourceDirName:"guides/composedb-server",slug:"/guides/composedb-server/running-in-the-cloud",permalink:"/docs/0.4.x/guides/composedb-server/running-in-the-cloud",draft:!1,tags:[],version:"0.4.x",frontMatter:{},sidebar:"guides",previous:{title:"Running Locally",permalink:"/docs/0.4.x/guides/composedb-server/running-locally"},next:{title:"Server Configurations",permalink:"/docs/0.4.x/guides/composedb-server/server-configurations"}},l={},c=[{value:"Things to Know",id:"things-to-know",level:2},{value:"Cloud Requirements",id:"cloud-requirements",level:2},{value:"Docker Hub",id:"docker-hub",level:2},{value:"Examples",id:"examples",level:2},{value:"Running IPFS",id:"running-ipfs",level:3},{value:"Running Postgres",id:"running-postgres",level:3},{value:"Running Ceramic",id:"running-ceramic",level:3},{value:"Editing the <code>daemon.config.json</code> file",id:"editing-the-daemonconfigjson-file",level:3},{value:"Next Steps",id:"next-steps",level:2}],u={toc:c},p="wrapper";function d(e){let{components:n,...t}=e;return(0,o.kt)(p,(0,r.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"running-in-the-cloud"},"Running in the Cloud"),(0,o.kt)("p",null,"Run a ComposeDB server in the cloud"),(0,o.kt)("h2",{id:"things-to-know"},"Things to Know"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"ComposeDB Server requires running a Ceramic node (which uses IPFS) for decentralized data, ",(0,o.kt)("a",{parentName:"li",href:"https://ipfs.tech/"},"IPFS"),", and a Postgres DB. Each should be within a separate Docker container."),(0,o.kt)("li",{parentName:"ul"},"This guide is focused on running in the cloud using docker. If you use npm, you can follow the same steps as ",(0,o.kt)("a",{parentName:"li",href:"/docs/0.4.x/guides/composedb-server/running-locally"},"Running Locally"),"."),(0,o.kt)("li",{parentName:"ul"},"Docker images for\xa0IPFS are built from the ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/ceramicnetwork/go-ipfs-daemon"},(0,o.kt)("inlineCode",{parentName:"a"},"go-ipfs-daemon"))," repository and come pre-configured with plugins that make it easy to run IPFS on cloud infrastructure (e.g. the ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/ipfs/go-ds-s3"},"S3 plugin"),"). Images built from the ",(0,o.kt)("inlineCode",{parentName:"li"},"main")," branch are tagged with\xa0",(0,o.kt)("inlineCode",{parentName:"li"},"latest"),", and\xa0the git commit hash of the code from which the image was built."),(0,o.kt)("li",{parentName:"ul"},"Docker images to run ComposeDB Server are built from the ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/ceramicnetwork/js-ceramic"},"js-ceramic")," repository. Images built from the ",(0,o.kt)("inlineCode",{parentName:"li"},"main")," branch are tagged with\xa0",(0,o.kt)("inlineCode",{parentName:"li"},"latest"),", the git commit hash of the code from which the image was built, and the npm package version of the corresponding ",(0,o.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/@ceramicnetwork/cli"},(0,o.kt)("inlineCode",{parentName:"a"},"@ceramicnetwork/cli"))," release.")),(0,o.kt)("admonition",{type:"danger"},(0,o.kt)("p",{parentName:"admonition"},"To run a Ceramic node in production, it is critical to persist the ",(0,o.kt)("a",{parentName:"p",href:"https://developers.ceramic.network/run/nodes/nodes/#ceramic-state-store"},"Ceramic state store")," and the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ipfs/go-ipfs/blob/master/docs/config.md#datastorespec"},"IPFS datastore"),". The form of storage you choose should also be configured for disaster recovery with data redundancy, and some form of snapshotting and/or backups. ",(0,o.kt)("strong",{parentName:"p"},"Loss of this data can result in permanent loss of Ceramic streams and will cause your node to be in a corrupt state."))),(0,o.kt)("h2",{id:"cloud-requirements"},"Cloud Requirements"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Supported Operating Systems")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Linux"),(0,o.kt)("li",{parentName:"ul"},"Mac"),(0,o.kt)("li",{parentName:"ul"},"Windows ")),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"For Windows, Windows Subsystem for Linux 2 (WSL2) is strongly recommended. Using the Windows command line is not portable and can cause compatibility issue when running the same configuration on a different operating system (e.g. in a Linux-based cloud deployment).")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Compute")),(0,o.kt)("p",null,"You\u2019ll need sufficient compute to power Ceramic, IPFS, and Postgres. At a minimum:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"4 vCPUs"),(0,o.kt)("li",{parentName:"ul"},"8GB RAM")),(0,o.kt)("h2",{id:"docker-hub"},"Docker Hub"),(0,o.kt)("p",null,"You can find the ComposeDB server and IPFS Docker images on ",(0,o.kt)("a",{parentName:"p",href:"https://hub.docker.com/u/ceramicnetwork"},"Docker Hub"),"."),(0,o.kt)("h2",{id:"examples"},"Examples"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Make sure to update the examples by setting your variables.")),(0,o.kt)("h3",{id:"running-ipfs"},"Running IPFS"),(0,o.kt)("p",null,'For production deployments you should run your own IPFS process manually and point your Ceramic node at it. This is referred to as running IPFS in "remote" mode in the Ceramic ',(0,o.kt)("inlineCode",{parentName:"p"},"daemon.config.json")," file, versus the pre-configured \u201cbundled\u201d mode used for running locally."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"docker pull ceramicnetwork/go-ipfs-daemon:latest\n\ndocker run \\\n  -p 5001:5001 \\ # API port\n  -p 8011:8011 \\ # Healthcheck port\n  -v /path_on_volume_for_ipfs_repo:/data/ipfs \\\n  --name ipfs \\\n  go-ipfs-daemon\n")),(0,o.kt)("h3",{id:"running-postgres"},"Running Postgres"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"docker pull postgres\n\ndocker run -d \\\n  -e POSTGRES_PASSWORD=mysecretpassword \\\n  -e PGDATA=/var/lib/postgresql/data/pgdata \\\n  -v /path_on_volume_for_postgres_data:/var/lib/postgresql/data \\\n  -p 5432:5432 \\\n  --name postgres \\\n  postgres\n")),(0,o.kt)("p",null,"You can also follow the examples from the official Postgres Docker image ",(0,o.kt)("a",{parentName:"p",href:"https://hub.docker.com/_/postgres"},"documentation"),"."),(0,o.kt)("h3",{id:"running-ceramic"},"Running Ceramic"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"docker pull ceramicnetwork/js-ceramic:latest\n\ndocker run -d \\\n  -p 7007:7007 \\\n  -v /path_on_volume_for_daemon_config:/root/.ceramic/daemon.config.json \\\n  -v /path_on_volume_for_ceramic_logs:/root/.ceramic/logs \\\n  -v /path_on_volume_for_ceramic_statestore:/root/.ceramic/statestore \\\n  -e NODE_ENV=production \\\n  -e CERAMIC_INDEXING_DB_URI=postgres://username:password@host:5432/dbname \\\n  --name ceramic \\\n  js-ceramic --ipfs-api http://ipfs_ip_address:5001\n")),(0,o.kt)("h3",{id:"editing-the-daemonconfigjson-file"},"Editing the ",(0,o.kt)("inlineCode",{parentName:"h3"},"daemon.config.json")," file"),(0,o.kt)("p",null,"To have these IPFS and Postgres settings persist in your Ceramic node, edit the ",(0,o.kt)("inlineCode",{parentName:"p"},"daemon.config.json")," file to include IPFS information. The default location is ",(0,o.kt)("inlineCode",{parentName:"p"},"~/.ceramic/daemon.config.json"),". For a full file example, see the ",(0,o.kt)("a",{parentName:"p",href:"https://developers.ceramic.network/run/nodes/nodes/#example-daemonconfigjson"},"Ceramic")," docs."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'...\n    "ipfs": {\n        "mode": "remote",\n        "host": "http://ipfs_ip_address:5001"\n    },\n... \n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'...\n"indexing": {\n    "db": "postgres://username:password@host:5432/dbname",\n    "allow-queries-before-historical-sync": true,\n    "enable-historical-sync": false\n  }\n...\n')),(0,o.kt)("h2",{id:"next-steps"},"Next Steps"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Understand the different ways to ",(0,o.kt)("a",{parentName:"li",href:"/docs/0.4.x/guides/composedb-server/server-configurations"},"configure your server"),", including choosing a network"),(0,o.kt)("li",{parentName:"ul"},"Use your Admin DID to authenticate your node to gain ",(0,o.kt)("a",{parentName:"li",href:"/docs/0.4.x/guides/composedb-server/access-mainnet"},"access to mainnet"))))}d.isMDXComponent=!0}}]);